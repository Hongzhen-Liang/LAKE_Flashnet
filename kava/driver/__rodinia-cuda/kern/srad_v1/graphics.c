//====================================================================================================100
//====================================================================================================100
//	INCLUDE/DEFINE
//====================================================================================================100
//====================================================================================================100


//====================================================================================================100
//====================================================================================================100
//	WRITE FUNCTION
//====================================================================================================100
//====================================================================================================100

void write_graphics(char* filename,
					int *input,
					int data_rows,
					int data_cols,
					int major,
					int data_range) {

	//================================================================================80
	//	VARIABLES
	//================================================================================80

	struct file *fid;
	int i, j;
    loff_t pos;

	//================================================================================80
	//	CREATE/OPEN FILE FOR WRITING
	//================================================================================80

	fid = filp_open(filename, O_WRONLY, 0);
	if( fid == NULL ){
		pr_err( "The file was not created/opened for writing\n" );
		return;
	}

	//================================================================================80
	//	WRITE PGM FILE HEADER
	//================================================================================80

    kernel_write(fid, (const void *)"P2\n", 3, &pos);
    kernel_write(fid, (const void *)&data_cols, sizeof(int), &pos);
    kernel_write(fid, (const void *)&data_rows, sizeof(int), &pos);
    kernel_write(fid, (const void *)&data_range, sizeof(int), &pos);

	//================================================================================80
	//	WRITE VALUES TO THE FILE
	//================================================================================80

	// if matrix is saved row major in memory (C)
	if(major==0){
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
                kernel_write(fid, (const void *)&input[i*data_cols+j], sizeof(int), &pos);
			}
		}
	}
	// if matrix is saved column major in memory (MATLAB)
	else{
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
                kernel_write(fid, (const void *)&input[j*data_rows+i], sizeof(int), &pos);
			}
		}
	}

	//================================================================================80
	//	CLOSE FILE
	//================================================================================80

    filp_close(fid, NULL);
}

//====================================================================================================100
//====================================================================================================100
//	READ FUNCTION
//====================================================================================================100
//====================================================================================================100

void read_graphics(char* filename,
                    int* input,
                    int data_rows,
                    int data_cols,
                    int major) {

	//================================================================================80
	//	VARIABLES
	//================================================================================80

	struct file *fid;
	int i, j;
	char c;
	int temp;
    loff_t pos = 0;

	//================================================================================80
	//	OPEN FILE FOR READING
	//================================================================================80

	fid = filp_open(filename, O_RDONLY, 0);
	if(fid == NULL){
		pr_err( "The file was not opened for reading\n" );
		return;
	}

	//================================================================================80
	//	SKIP PGM FILE HEADER
	//================================================================================80

	i = 0;
	while(i<3){
        kernel_read(fid, (char *)&c, sizeof(char), &pos);
		if(c == '\n'){
			i = i+1;
		}
	};

	//================================================================================80
	//	READ VALUES FROM THE FILE
	//================================================================================80

	if(major==0){										// if matrix is saved row major in memory (C)
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
                kernel_read(fid, (char *)&temp, sizeof(int), &pos);
				input[i*data_cols+j] = temp;
			}
		}
	}
	else{												// if matrix is saved column major in memory (MATLAB)
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
                kernel_read(fid, (char *)&temp, sizeof(int), &pos);
				input[j*data_rows+i] = temp;
			}
		}
	}

	//================================================================================80
	//	CLOSE FILE
	//================================================================================80

    filp_close(fid, NULL);
}
